<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PokÃ©mon Stat Master</title>

<style>
:root {
    --primary: #ef4444;
    --success: #10b981;
    --danger: #ef4444;
    --card-bg: rgba(255, 255, 255, 0.98);
    --text-main: #1e293b;
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: 'Inter', -apple-system, sans-serif;
    background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%);
    color: #f8fafc;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 15px;
    overflow-x: hidden;
}

.menu-card {
    background: var(--card-bg);
    width: 100%;
    max-width: 380px;
    padding: 30px 20px;
    border-radius: 24px;
    box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5);
    text-align: center;
    color: var(--text-main);
    position: relative;
    overflow: hidden;
    user-select: none;
}

.menu-title {
    font-size: 24px;
    font-weight: 900;
    margin: 5px 0;
    text-transform: uppercase;
    background: linear-gradient(135deg, #ef4444 0%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.game-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding: 0 5px;
    font-size: 10px;
    font-weight: 800;
    text-transform: uppercase;
}

.exit-small-btn {
    background: #fee2e2;
    color: #ef4444;
    border: none;
    padding: 8px 15px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 800;
    font-size: 11px;
    text-transform: uppercase;
}

.btn-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
}

.menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 50px;
    border-radius: 14px;
    font-size: 14px;
    font-weight: 800;
    cursor: pointer;
    border: none;
    text-transform: uppercase;
}

.menu-btn:active {
    transform: scale(0.98);
}

.mode-easy { background: #10b981; color: white; }
.mode-med  { background: #f59e0b; color: white; }
.mode-hard { background: #ef4444; color: white; }

.exit-link-btn {
    background: white;
    color: #64748b;
    border: 2px solid #e2e8f0;
    text-decoration: none;
}

.stat-display {
    background: #f8fafc;
    padding: 15px;
    border-radius: 18px;
    margin-bottom: 15px;
    border: 1px solid #e2e8f0;
}

.stat-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
    font-size: 10px;
    font-weight: 800;
    text-transform: uppercase;
}

.stat-label {
    width: 40px;
    color: #64748b;
    text-align: left;
}

.stat-bar-bg {
    flex-grow: 1;
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    margin: 0 8px;
    overflow: hidden;
}

.stat-bar-fill {
    height: 100%;
    border-radius: 4px;
    width: 0;
    transition: width 0.8s ease-out;
}

.stat-val {
    width: 25px;
    text-align: right;
    color: #1e293b;
}

.bst-badge {
    display: inline-block;
    padding: 4px 12px;
    background: var(--primary);
    color: white;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 800;
    margin-top: 8px;
}

.option-btn {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border: 2px solid #e2e8f0;
    border-radius: 18px;
    background: white;
    width: 100%;
    margin-bottom: 6px;
    cursor: pointer;
}

.option-btn:active {
    background: #f1f5f9;
}

.option-btn img {
    width: 55px;
    height: 55px;
    image-rendering: pixelated;
}

.option-btn span {
    font-size: 13px;
    font-weight: 800;
    color: #334155;
    text-transform: capitalize;
}

#overlay, #success-overlay {
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.98);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 100;
    padding: 20px;
}

.creator-credit {
    margin-top: 25px;
    font-size: 9px;
    font-weight: 800;
    text-transform: lowercase;
    letter-spacing: 2px;
    color: #94a3b8;
    opacity: 0.6;
    text-align: center;
    border-top: 1px solid #e2e8f0;
    padding-top: 12px;
    width: 180px;
    margin-left: auto;
    margin-right: auto;
}
</style>
</head>

<body>

<div id="main-menu" class="menu-card">
    <div style="font-size: 35px;">ðŸ“Š</div>
    <h1 class="menu-title">Stat Master</h1>

    <div class="btn-group">
        <button class="menu-btn mode-easy" onclick="startGame('easy')">Easy</button>
        <button class="menu-btn mode-med" onclick="startGame('medium')">Medium</button>
        <button class="menu-btn mode-hard" onclick="startGame('hard')">Hard</button>
        <a href="https://xoelpr03.github.io/dexv1.1/" class="menu-btn exit-link-btn">Return to PokÃ©dex</a>
    </div>

    <div class="creator-credit">created by Î¾awsjÎ±ke</div>
</div>

<div id="game-container" style="display:none;width:100%;max-width:400px;">
    <div class="menu-card">
        <div class="game-header">
            <div id="mode-indicator">MODE: EASY</div>
            <div style="display:flex;gap:10px;align-items:center;">
                <div>Streak: <span id="current-score">0</span></div>
                <button class="exit-small-btn" onclick="stopGame()">Quit</button>
            </div>
        </div>

        <div id="success-overlay">
            <h2 style="color:var(--success);font-weight:900;">Correct</h2>
            <img id="success-img" width="100" height="100" style="image-rendering:pixelated;">
            <p id="success-name" style="font-size:18px;font-weight:800;color:#3b82f6;"></p>
        </div>

        <div id="overlay">
            <h2 style="color:var(--danger);font-weight:900;">Failed</h2>
            <img id="correct-img" width="100" height="100" style="image-rendering:pixelated;">
            <p style="font-weight:800;">Target: <span id="correct-name" style="color:#3b82f6;"></span></p>
            <button class="menu-btn mode-easy" onclick="initStatsGame()">Try Again</button>
            <button onclick="stopGame()" style="margin-top:15px;background:none;border:none;color:#94a3b8;text-decoration:underline;cursor:pointer;">Back to Menu</button>
        </div>

        <div id="game-stats"></div>
        <div id="game-options"></div>
    </div>
</div>

<script>
let currentScore = 0;
let targetPoke = null;
let currentGameMode = 'easy';

const STAT_LABELS = {
    hp: 'HP', attack: 'ATK', defense: 'DEF',
    'special-attack': 'SPA', 'special-defense': 'SPD', speed: 'SPE'
};

// Helper: Calculate BST
const calcBST = (p) => p.stats.reduce((acc, s) => acc + s.base_stat, 0);

// Helper: Calculate "Spread Similarity" (Standard Deviation of stats)
// Hard mode uses this to find pokemon with similar peaks and valleys
const getSpreadScore = (p) => {
    const values = p.stats.map(s => s.base_stat);
    const avg = values.reduce((a, b) => a + b) / 6;
    return Math.sqrt(values.map(x => Math.pow(x - avg, 2)).reduce((a, b) => a + b) / 6);
};

function getStatColor(val) {
    if (val <= 50) return '#ef4444';
    if (val <= 80) return '#f59e0b';
    if (val <= 110) return '#10b981';
    return '#3b82f6';
}

function startGame(mode) {
    currentGameMode = mode;
    currentScore = 0;
    document.getElementById('current-score').innerText = '0';
    document.getElementById('mode-indicator').innerText = `MODE: ${mode.toUpperCase()}`;
    initStatsGame();
}

async function initStatsGame() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('success-overlay').style.display = 'none';
    document.getElementById('main-menu').style.display = 'none';
    document.getElementById('game-container').style.display = 'block';

    const statsDiv = document.getElementById('game-stats');
    const optionsDiv = document.getElementById('game-options');
    statsDiv.innerHTML = "<div style='padding:20px;color:#94a3b8;'>Loading...</div>";
    optionsDiv.innerHTML = "";

    // 1. Get Target
    const id = Math.floor(Math.random() * 800) + 1;
    const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
    targetPoke = await res.json();
    const targetBST = calcBST(targetPoke);
    const targetSpread = getSpreadScore(targetPoke);

    renderStats(targetPoke, statsDiv);

    const choices = [targetPoke];

    // 2. Filter for Difficulty
    while (choices.length < 4) {
        const cid = Math.floor(Math.random() * 800) + 1;
        if (cid === targetPoke.id) continue;

        const p = await fetch(`https://pokeapi.co/api/v2/pokemon/${cid}`).then(r => r.json());
        const pBST = calcBST(p);
        const pSpread = getSpreadScore(p);

        let isQualified = false;

        if (currentGameMode === 'easy') {
            isQualified = true; // Any random pokemon
        } else if (currentGameMode === 'medium') {
            // Must have BST within +/- 30 of target
            isQualified = Math.abs(targetBST - pBST) <= 30;
        } else if (currentGameMode === 'hard') {
            // Must have BST within +/- 15 AND similar spread (standard deviation)
            isQualified = Math.abs(targetBST - pBST) <= 15 && Math.abs(targetSpread - pSpread) <= 10;
        }

        if (isQualified && !choices.find(c => c.id === p.id)) {
            choices.push(p);
        }
    }

    choices.sort(() => Math.random() - 0.5).forEach(p => {
        const b = document.createElement('button');
        b.className = 'option-btn';
        b.innerHTML = `<img src="${p.sprites.front_default}"><span>${p.name}</span>`;
        b.onclick = () => handleChoice(p);
        optionsDiv.appendChild(b);
    });
}

function handleChoice(p) {
    if (p.id === targetPoke.id) {
        currentScore++;
        document.getElementById('current-score').innerText = currentScore;
        document.getElementById('success-name').innerText = p.name;
        document.getElementById('success-img').src = p.sprites.front_default;
        document.getElementById('success-overlay').style.display = 'flex';
        setTimeout(initStatsGame, 1800);
    } else {
        document.getElementById('correct-name').innerText = targetPoke.name;
        document.getElementById('correct-img').src = targetPoke.sprites.front_default;
        document.getElementById('overlay').style.display = 'flex';
    }
}

function renderStats(poke, container) {
    let bst = 0;
    let html = '<div class="stat-display">';
    poke.stats.forEach(s => {
        bst += s.base_stat;
        html += `
        <div class="stat-row">
            <span class="stat-label">${STAT_LABELS[s.stat.name]}</span>
            <div class="stat-bar-bg">
                <div class="stat-bar-fill" id="bar-${s.stat.name}" style="background:${getStatColor(s.base_stat)};"></div>
            </div>
            <span class="stat-val">${s.base_stat}</span>
        </div>`;
    });
    html += `<div class="bst-badge">BST: ${bst}</div></div>`;
    container.innerHTML = html;

    setTimeout(() => {
        poke.stats.forEach(s => {
            const bar = document.getElementById(`bar-${s.stat.name}`);
            if (bar) bar.style.width = `${Math.min(100, s.base_stat / 180 * 100)}%`;
        });
    }, 50);
}

function stopGame() {
    document.getElementById('game-container').style.display = 'none';
    document.getElementById('main-menu').style.display = 'block';
}
</script>

</body>
</html>


